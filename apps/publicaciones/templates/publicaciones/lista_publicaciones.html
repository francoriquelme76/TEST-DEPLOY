{% extends 'base.html' %} 

{% block title %}
    {# Usamos el tÃ­tulo que viene del contexto (lista_publicaciones) #}
    Ãšltimas Noticias | {% if titulo %}{{ titulo }}{% else %}Inicio{% endif %}
{% endblock title %}

{% block contenido %}

    {# TÃ­tulo dinÃ¡mico: Usa el nombre de la categorÃ­a si estamos filtrando, sino usa "Ãšltimas Publicaciones" #}
    <h2>{% if categoria_actual %}Noticias de {{ categoria_actual.nombre }}{% else %}Ãšltimas Publicaciones{% endif %}</h2>
    
    {# ----------------------------------------------------------- #}
    {# ğŸš¨ LEYENDA DE GUÃA PARA VISITANTES ANÃ“NIMOS ğŸš¨ #}
    {% if not user.is_authenticated %}
    <div style="background-color: #f0f8ff; border: 1px solid #cceeff; padding: 10px; margin-bottom: 20px; border-radius: 5px; color: #333;">
        <p style="margin: 0;">
            ğŸ‘‹ Â¡Bienvenido Visitante! Para leer el artÃ­culo completo y poder dejar un comentario, haz CLIC sobre el tÃ­tulo de la publicaciÃ³n que te interese.
        </p>
    </div>
    {% endif %}
    {# ----------------------------------------------------------- #}

    {# ğŸš¨ INICIO DE LA LÃ“GICA DE CATEGORÃAS ğŸš¨ #}
    {% if categorias %}
        <h3>Selecciona una CategorÃ­a:</h3>
        <ul style="list-style: none; padding: 0;">
            {% for categoria in categorias %}
                <li style="display: inline; margin-right: 15px;">
                    {# El enlace que filtra por categorÃ­a #}
                    <a href="{% url 'publicaciones:por_categoria' slug_categoria=categoria.slug %}">
                        [ {{ categoria.nombre }} ]
                    </a>
                </li>
            {% empty %}
                 <p>No hay categorÃ­as disponibles.</p>
            {% endfor %}
        </ul>
        <hr>
        
        {# OpciÃ³n para volver a la lista completa si estamos en una vista filtrada #}
        {% if categoria_actual %}
            <p><a href="{% url 'publicaciones:lista' %}">Mostrar todas las publicaciones</a></p>
            <hr>
        {% endif %}
    {% endif %}

    <div class="orden-container" style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
        <span style="font-weight: bold; color: #555;">Ordenar por:</span>
        
        <a href="?orden=reciente" class="btn-orden {% if orden_actual == 'reciente' or not orden_actual %}activo{% endif %}">
            ğŸ“… MÃ¡s recientes
        </a>

        <a href="?orden=antiguo" class="btn-orden {% if orden_actual == 'antiguo' %}activo{% endif %}">
            â³ MÃ¡s antiguas
        </a>

        <a href="?orden=comentarios" class="btn-orden {% if orden_actual == 'comentarios' %}activo{% endif %}">
            ğŸ’¬ MÃ¡s populares
        </a>
    </div>

    {# ğŸš¨ FIN DE LA LÃ“GICA DE CATEGORÃAS ğŸš¨ #}

    {# Lista de Publicaciones #}
    {% for publicacion in publicaciones %}
    <article style="border-bottom: 1px dashed #ccc; padding-bottom: 15px; margin-bottom: 15px;">
        <h3>
            {# AsegÃºrate de que el tÃ­tulo es un enlace para ir al detalle #}
            <a href="{% url 'publicaciones:detalle' slug=publicacion.slug pk=publicacion.pk %}">
                {{ publicacion.titulo }}
            </a>
        </h3>
        <p>CategorÃ­a: **{{ publicacion.categoria.nombre }}** | Autor: **{{ publicacion.autor.username }}**</p>
        <p>{{ publicacion.contenido|truncatewords:20 }}</p> 
        <hr>
    </article>
    {% empty %}
        <p>No hay publicaciones disponibles en esta secciÃ³n {% if categoria_actual %}para la categorÃ­a "{{ categoria_actual.nombre }}"{% endif %}.</p>
    {% endfor %}

{% endblock contenido %}