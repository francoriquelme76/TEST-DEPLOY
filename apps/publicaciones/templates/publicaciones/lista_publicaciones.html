{% extends 'base.html' %} 

{% block title %}
    {# Usamos el tÃ­tulo que viene del contexto (lista_publicaciones) #}
    Ãšltimas Noticias | {% if titulo %}{{ titulo }}{% else %}Inicio{% endif %}
{% endblock title %}

{% block contenido %}

    {# TÃ­tulo dinÃ¡mico: Usa el nombre de la categorÃ­a si estamos filtrando, sino usa "Ãšltimas Publicaciones" #}
    <h2>{% if categoria_actual %}Noticias de {{ categoria_actual.nombre }}{% else %}Ãšltimas Publicaciones{% endif %}</h2>
    
    {# ----------------------------------------------------------- #}
    {# ğŸš¨ LEYENDA DE GUÃA PARA VISITANTES ANÃ“NIMOS ğŸš¨ #}
    {% if not user.is_authenticated %}
    <div style="background-color: #f0f8ff; border: 1px solid #cceeff; padding: 10px; margin-bottom: 20px; border-radius: 5px; color: #333;">
        <p style="margin: 0;">
            ğŸ‘‹ Â¡Bienvenido Visitante! Para leer el artÃ­culo completo y poder dejar un comentario, haz CLIC sobre el tÃ­tulo de la publicaciÃ³n que te interese.
        </p>
    </div>
    {% endif %}
    {# ----------------------------------------------------------- #}

    {# ğŸš¨ INICIO DE LA LÃ“GICA DE CATEGORÃAS ğŸš¨ #}
    <div class="barra-info">
    <span style="color: #6c757d;">Mostrando:</span> 
    <strong style="color: #0d6efd;">
        {% if categoria_actual %}
            {{ categoria_actual|title }}
        {% else %}
            Todas las noticias
        {% endif %}
    </strong>
    <span style="color: #6c757d; margin: 0 10px;">|</span>
    <span style="color: #6c757d;">Orden:</span> 
    <strong>
        {% if orden_actual == 'antiguo' %}â³ Antiguas
        {% elif orden_actual == 'comentarios' %}ğŸ’¬ Populares
        {% else %}ğŸ“… Recientes{% endif %}
    </strong>

    {% if categoria_actual or orden_actual != 'reciente' %}
        <a href="?" style="float: right; color: #dc3545; text-decoration: none; font-size: 0.9em;">âœ– Limpiar</a>
    {% endif %}
</div>

{% if categorias %}
    <h3 style="margin-bottom: 15px;">Selecciona una CategorÃ­a:</h3>
    <ul style="list-style: none; padding: 0; margin-bottom: 20px;">
        <li style="display: inline; margin-right: 15px;">
            <a href="?orden={{ orden_actual|default:'reciente' }}" 
               class="enlace-filtro {% if not categoria_actual %}activo-categoria{% endif %}">
                [ Todas ]
            </a>
        </li>
        {% for categoria in categorias %}
            <li style="display: inline; margin-right: 15px;">
                <a href="?categoria={{ categoria.slug }}&orden={{ orden_actual|default:'reciente' }}" 
                   class="enlace-filtro {% if categoria_actual == categoria.slug %}activo-categoria{% endif %}">
                    [ {{ categoria.nombre }} ]
                </a>
            </li>
        {% endfor %}
    </ul>
    <hr>
{% endif %}

<div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
    <span style="font-weight: bold; color: #555;">Ordenar por:</span>
    
    <a href="?categoria={{ categoria_actual|default:'' }}&orden=reciente" 
       class="btn-orden {% if orden_actual == 'reciente' or not orden_actual %}activo-orden{% endif %}"
       style="text-decoration: none; padding: 5px 10px; border: 1px solid #ccc; border-radius: 5px;">
        ğŸ“… Recientes
    </a>

    <a href="?categoria={{ categoria_actual|default:'' }}&orden=antiguo" 
       class="btn-orden {% if orden_actual == 'antiguo' %}activo-orden{% endif %}"
       style="text-decoration: none; padding: 5px 10px; border: 1px solid #ccc; border-radius: 5px;">
        â³ Antiguas
    </a>

    <a href="?categoria={{ categoria_actual|default:'' }}&orden=comentarios" 
       class="btn-orden {% if orden_actual == 'comentarios' %}activo-orden{% endif %}"
       style="text-decoration: none; padding: 5px 10px; border: 1px solid #ccc; border-radius: 5px;">
        ğŸ’¬ Populares
    </a>
</div>
    {# ğŸš¨ FIN DE LA LÃ“GICA DE CATEGORÃAS ğŸš¨ #}

    {# Lista de Publicaciones #}
    {% for publicacion in publicaciones %}
    <article style="border-bottom: 1px dashed #ccc; padding-bottom: 15px; margin-bottom: 15px;">
        <h3>
            {# AsegÃºrate de que el tÃ­tulo es un enlace para ir al detalle #}
            <a href="{% url 'publicaciones:detalle' slug=publicacion.slug pk=publicacion.pk %}">
                {{ publicacion.titulo }}
            </a>
        </h3>
        <p>CategorÃ­a: **{{ publicacion.categoria.nombre }}** | Autor: **{{ publicacion.autor.username }}**</p>
        <p>{{ publicacion.contenido|truncatewords:20 }}</p> 
        <hr>
    </article>
    {% empty %}
        <p>No hay publicaciones disponibles en esta secciÃ³n {% if categoria_actual %}para la categorÃ­a "{{ categoria_actual.nombre }}"{% endif %}.</p>
    {% endfor %}

{% endblock contenido %}