{% extends 'base.html' %}

{% block contenido %}

    {# T칤tulo din치mico: Usa el nombre de la categor칤a si estamos filtrando, sino usa "칔ltimas Publicaciones" #}
    <h2>{% if categoria_actual %}Noticias de {{ categoria_actual.nombre }}{% else %}칔ltimas Publicaciones{% endif %}</h2>
    
    {# 游뚿 INICIO DE LA L칍GICA DE CATEGOR칈AS 游뚿 #}
    {# Muestra el men칰 de categor칤as si el usuario lo pidi칩 (request.GET.mostrar_categorias) o si ya est치 viendo una categor칤a (categoria_actual) #}
    {% if request.GET.mostrar_categorias or categoria_actual %}
        <h3>Selecciona una Categor칤a:</h3>
        <ul style="list-style: none; padding: 0;">
            {% for categoria in categorias %}
                <li style="display: inline; margin-right: 15px;">
                    {# El enlace que filtra por categor칤a (usa la nueva URL 'por_categoria') #}
                    <a href="{% url 'publicaciones:por_categoria' slug_categoria=categoria.slug %}">
                        [ {{ categoria.nombre }} ]
                    </a>
                </li>
            {% empty %}
                <p>No hay categor칤as disponibles. (Revisa si creaste categor칤as en /admin/)</p>
            {% endfor %}
        </ul>
        <hr>
        
        {# Opci칩n para volver a la lista completa si estamos en una vista filtrada #}
        {% if categoria_actual %}
            <p><a href="{% url 'publicaciones:lista' %}">Mostrar todas las publicaciones</a></p>
            <hr>
        {% endif %}
    {% endif %}

    {# 游뚿 FIN DE LA L칍GICA DE CATEGOR칈AS 游뚿 #}

    {# Lista de Publicaciones #}
    {% for publicacion in object_list %}
    <article style="border-bottom: 1px dashed #ccc; padding-bottom: 15px; margin-bottom: 15px;">
        <h3>
            {# Aseg칰rate de que el t칤tulo es un enlace para ir al detalle #}
            <a href="{% url 'publicaciones:detalle' slug=publicacion.slug pk=publicacion.pk %}">
                {{ publicacion.titulo }}
            </a>
        </h3>
        <p>Categor칤a: **{{ publicacion.categoria.nombre }}** | Autor: **{{ publicacion.autor.username }}**</p>
        <p>{{ publicacion.contenido|truncatewords:20 }}</p> 
        <hr>
    </article>
    {% empty %}
        <p>No hay publicaciones disponibles en esta secci칩n {% if categoria_actual %}para la categor칤a "{{ categoria_actual.nombre }}"{% endif %}.</p>
    {% endfor %}

{% endblock contenido %}