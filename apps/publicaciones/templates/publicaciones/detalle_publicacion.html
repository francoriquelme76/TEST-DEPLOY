{% extends 'base.html' %} 
{# Nota: Usualmente se extiende 'base.html' directamente, a menos que tengas un base.html espec칤fico para la app 'publicaciones' #}

{% block titulo %}{{ publicacion.titulo }}{% endblock titulo %}

{% block contenido %}

    <article>
        <h2>{{ publicacion.titulo }}</h2>
        
        <p>
            Categor칤a: <b>{{ publicacion.categoria }}</b> | 
            Autor: <b>{{ publicacion.autor }}</b> | 
            Publicado el: {{ publicacion.fecha_creacion|date:"d M Y" }}
        </p>

        <hr>

        <p>{{ publicacion.contenido }}</p>

        <hr>

        {# L칍GICA DE EDICI칍N: El bot칩n solo aparece si el usuario logueado es el autor #}
        {% if user.is_authenticated and user == publicacion.autor %}
            <p>
                {# Usamos la URL 'publicaciones:editar' que definimos en urls.py #}
                <a href="{% url 'publicaciones:editar' pk=publicacion.pk %}">
                    <button>Editar Publicaci칩n</button>
                </a>
            </p>
            {# Opcional: Si implementamos la eliminaci칩n m치s tarde, ir칤a aqu칤 #}
        {% endif %}

    </article>

    <h3>Comentarios ({{ comentarios.count }})</h3>
    
    {% for comentario in comentarios %}
        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
            <p><strong>{{ comentario.autor.username }}</strong> dice:</p>
            <p>{{ comentario.texto }}</p>
            <small>{{ comentario.fecha_creacion|date:"d M Y H:i" }}</small>
        </div>
    {% empty %}
        <p>S칠 el primero en comentar.</p>
    {% endfor %}

    {# 游뚿 SECCI칍N CORREGIDA: Restricci칩n para comentar 游뚿 #}
    {% if user.is_authenticated %}
        <h4>Deja tu comentario</h4>
        {# El action del formulario debe apuntar a la URL de tu vista agregar_comentario #}
        <form method="post" action="{% url 'comentarios:agregar' publicacion_id=publicacion.pk %}">
            {% csrf_token %}
            {{ comentario_form.as_p }}
            <button type="submit">Enviar Comentario</button>
        </form>
    {% else %}
        <p>Debes <a href="{% url 'login' %}">iniciar sesi칩n</a> para comentar.</p>
    {% endif %}

{% endblock contenido %}
